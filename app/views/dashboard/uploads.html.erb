<div class="container index-page">
  <h1 class="mb-4"><%= t('.title') %></h1>
  <ul class="table-key list-unstyled list-inline pt-3">
    <% Settings.metadata_status.each do |status, values| %>
    <li class="list-inline-item">
      <%= bootstrap_icon(values.icon_class, class: "pod-metadata-status #{status}") %>
      <span><%= values.label %></span>
    </li>
    <% end %>
  </ul>
  <table class="table table-striped mb-3">
    <thead>
      <tr>
        <th class="text-center"><%= t('.table.status') %></th>
        <th><%= t('.table.upload') %></th>
        <th><%= t('.table.filename') %></th>
        <th><%= t('.table.date_created') %></th>
        <th><%= t('.table.provider') %></th>
        <th class="text-end"><%= t('.table.size') %></th>
        <th class="text-end"><%= t('.table.record_count') %></th>
      </tr>
    </thead>
    <tbody>
      <% @uploads.each do |upload| %>
      <% upload.files.each do |file| %>
      <tr>
        <td class="text-center">
          <%= bootstrap_icon(Settings.metadata_status[file.pod_metadata_status].icon_class, class: "pod-metadata-status #{file.pod_metadata_status}") %>
          <span class="visually-hidden"><%= file.pod_metadata_status %></span>
        </td>
        <td>
          <%= link_to_if can?(:read, upload), upload.name, organization_upload_path(upload.organization, upload), title: t('.table.upload_title', name: upload.name) %>
        </td>
        <td>
          <%= link_to_if can?(:read, upload), file.filename, download_url(file), title: t('.table.download_title', filename: file.filename) %>
        </td>
        <td><%= local_time(file.created_at, format: datetime_display_format()) %></td>
        <td><%= link_to upload.organization.name, organization_path(upload.organization) %></td>
        <td class="text-end"><%= number_to_human_size file.byte_size %></td>
        <td class="text-end"><%= file.metadata['count'] ? number_with_delimiter(file.metadata['count']) : '-' %></td>
      </tr>
      <% end %>
      <% end %>
    </tbody>
  </table>
  <%= paginate @uploads %>
</div>
